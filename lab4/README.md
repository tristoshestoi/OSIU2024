# Пример плохого CI/CD файла

# 1. Нет версионирования
# Отсутствие явного указания версии может привести к непредсказуемым результатам
# Например, мы просто используем latest tag, что может привести к ошибкам

image: docker:latest

# 2. Не выполняется тестирование
# Запуск без тестов может привести к тому, что ошибки не будут обнаружены до выхода в продакшен

stages:
  - build
  - deploy

build:
  stage: build
  script:
    - echo "Building..."

# 3. Неправильное использование секретов
# Публикация секретов в открытом репозитории небезопасна
variables:
  SECRET_TOKEN: "12345"

# 4. Отсутствие уведомлений
# Разработчики не получают уведомлений о статусе сборки, что затрудняет выявление ошибок

# 5. Долгие процессы без параллельного выполнения
# Если все работает последовательно, это увеличивает время развертывания

deploy:
  stage: deploy
  script:
    - echo "Deploying..."
    - sleep 60  # эмуляция длительной операции




# Пример хорошего CI/CD файла

# 1. Версионирование образа
# Указываем конкретную версию образа
image: docker:1.19.3  # Используем стабильную версию образа

# 2. Выполнение тестов
# Добавление стадии тестирования для выявления ошибок до развёртывания
stages:
  - build
  - test
  - deploy

build:
  stage: build
  script:
    - echo "Building..."

# Тестирование приложения перед развертыванием
unit_tests:
  stage: test
  script:
    - echo "Running tests..."

# 3. Безопасное хранение секретов
# Используйте секреты, хранящиеся в безопасном месте, например, K8s secrets или secrets manager
variables:
  SECRET_TOKEN: "$SECRET_TOKEN"

# 4. Уведомления
# Добавление уведомлений о статусе сборки для разработчиков
notifications:
  email:
    recipients:
      - team@example.com

# 5. Параллельное выполнение процесса
# Разделение задач на несколько этапов для ускорения процесса развертывания
parallel:
  - build
  - test

deploy:
  stage: deploy
  script:
    - echo "Deploying..."


README с описанием плохих практик и их исправлений
Плохой CI/CD файл:
В этом разделе представлен плохой CI/CD файл и объясняется, какие плохие практики в нём содержатся.
1. Нет версионирования
Плохая практика: Используется тег latest, что может привести к неожиданным ошибкам в сборке.
Исправление: В хорошем файле указано конкретное версионирование образа (например, docker:1.19.3), что повышает предсказуемость и стабильность сборок.
2. Не выполняется тестирование
Плохая практика: Сборка и развертывание происходят без выполнения тестов, что может привести к появлению ошибок в продакшене.
Исправление: Добавлена стадия тестирования (например, unit_tests), что позволяет выявлять ошибки до развертывания и повышает качество кода.
3. Неправильное использование секретов
Плохая практика: Секреты хранятся в открытом виде в коде, что небезопасно и может привести к утечке данных.
Исправление: В хорошем файле секреты хранятся безопасно и загружаются из защищенного хранилища (например, K8s secrets), что улучшает безопасность приложения.
4. Отсутствие уведомлений
Плохая практика: Разработчики не получают уведомлений о статусе сборки, что затрудняет выявление ошибок и реагирование на них.
Исправление: В хорошем файле добавлены уведомления по электронной почте для команды, что позволяет оперативно реагировать на проблемы.
5. Долгие процессы без параллельного выполнения
Плохая практика: Все процессы выполняются последовательно, что замедляет развертывание и увеличивает время ожидания.
Исправление: В хорошем файле добавлено параллельное выполнение задач (например, parallel), что ускоряет процесс развертывания и делает его более эффективным.